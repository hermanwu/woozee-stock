<ng-container *ngIf="stockAnalysis === null; else hasStock">
  No result is supported for now.
</ng-container>

<ng-template #hasStock>
  <app-title-menu>
    <div header-1 i18n>
      <span
        >{{ stockAnalysis.shortName || stockAnalysis.name }} ({{
          stockAnalysis?.ticker | uppercase
        }})</span
      >
      <span *ngIf="rank$ | async; else followButton">
        - Rank {{ rank$ | async | undefined }}</span
      >
      <span *ngIf="stockAnalysis.price">
        - {{ stockAnalysis.price | undefined }}</span
      >
    </div>
    <div buttons>
      <button mat-icon-button [matMenuTriggerFor]="stockMenu">
        <mat-icon>more_horiz</mat-icon>
      </button>

      <mat-menu #stockMenu="matMenu">
        <button mat-menu-item [disabled]="">Add to Portfolio</button>

        <button
          class="buttons"
          mat-menu-item
          aria-label="Organize widgets"
          matTooltip="Organize Widgets"
          disabled
        >
          <mat-icon>sort</mat-icon>
        </button>

        <button
          class="buttons"
          mat-menu-item
          [matMenuTriggerFor]="menu"
          aria-label="navigate to sections"
          matTooltip="Navigator"
          disabled
        >
          <mat-icon>link</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item disabled>Business</button>
          <button mat-menu-item disabled>Growth</button>
          <button mat-menu-item disabled>Profit</button>
        </mat-menu>
      </mat-menu>
    </div>
  </app-title-menu>

  <div class="grid grid-dynamic">
    <div class="padding-1rem" *ngIf="opinions?.length > 0">
      <app-card>
        <app-title-menu>
          <div header-2>Opinions</div>

          <div buttons>
            <button buttons mat-icon-button [matMenuTriggerFor]="opinionMenu">
              <mat-icon>more_horiz</mat-icon>
            </button>

            <mat-menu #opinionMenu="matMenu">
              <button
                mat-menu-item
                type="button"
                (click)="setDisplayMode(displayModeEnum.list)"
              >
                <mat-icon>list</mat-icon>
              </button>
              <button
                mat-menu-item
                type="button"
                (click)="setDisplayMode(displayModeEnum.slide)"
              >
                <mat-icon>view_array</mat-icon>
              </button>

              <button mat-menu-item type="button" matTooltip="Add Risk">
                <mat-icon>add_circle</mat-icon>
              </button>
            </mat-menu>
          </div>
        </app-title-menu>

        <div class="grid">
          <app-card *ngFor="let opinion of opinions" class="opinion-display">
            <div>
              <app-opinion-item-display
                [opinion]="opinion"
              ></app-opinion-item-display>
            </div>
          </app-card>
        </div>

        <div *ngIf="displayMode === displayModeEnum.slide">
          <app-carousal
            [items]="risks"
            (indexOfSelected)="updateDisplayItem($event)"
          >
            <div class="risk-slides-overview">
              <ng-container *ngFor="let risk of risks; let i = index">
                <span
                  [ngClass]="{
                    'current-risk-slide': i === carousalDisplayItemIndex
                  }"
                >
                  {{ risk.type }}
                </span>
                <span>-></span>
              </ng-container>

              <span>Conclusion</span>
            </div>

            <div *ngFor="let risk of risks; let i = index">
              <app-card *ngIf="i === carousalDisplayItemIndex">
                <app-risk [risk]="risk"></app-risk>
              </app-card>
            </div>
          </app-carousal>
        </div>
      </app-card>
    </div>

    <div class="padding-1rem" *ngIf="news?.length > 0">
      <app-card>
        <app-title-menu>
          <div header-2>News</div>
        </app-title-menu>

        <div *ngFor="let item of news">
          <app-card>
            <app-news-display
              [shortVersion]="'true'"
              [news]="item"
            ></app-news-display>
          </app-card>
        </div>
      </app-card>
    </div>

    <div class="padding-1rem">
      <app-card>
        <app-earnings-report
          [stock]="stockAnalysis"
          [pastTwoYearsEarningsReports]="stockAnalysis?.earningsReports"
        ></app-earnings-report>
      </app-card>
    </div>

    <div class="padding-1rem">
      <app-card>
        <app-earnings-report
          [stock]="stockAnalysis"
          [pastTwoYearsEarningsReports]="
            stockAnalysis?.earningsReports?.slice(1)
          "
        ></app-earnings-report>
      </app-card>
    </div>

    <div class="padding-1rem" *ngIf="stockAnalysis">
      <app-fact [factType]="factType.business" [stock]="stockAnalysis">
        <app-business-overview [stock]="stockAnalysis"></app-business-overview>
      </app-fact>
    </div>

    <div class="padding-1rem">
      <app-fact [factType]="factType.growth" [stock]="stockAnalysis">
        <app-growth-details [stock]="stockAnalysis"></app-growth-details>

        <!-- <app-booster></app-booster> -->
      </app-fact>
    </div>

    <div class="padding-1rem">
      <app-fact [factType]="factType.profit" [stock]="stockAnalysis">
        <app-profitability-details
          [stock]="stockAnalysis"
        ></app-profitability-details>
      </app-fact>
    </div>

    <div class="padding-1rem">
      <app-fact [factType]="factType.valuation" [stock]="stockAnalysis">
        <app-valuation-details [stock]="stockAnalysis"></app-valuation-details>
      </app-fact>
    </div>

    <div class="padding-1rem" *ngIf="stockAnalysis.predications">
      <app-card>
        <h2>Ratings</h2>

        <div *ngIf="stockAnalysis?.predications">
          <div>
            Price:
            {{ stockAnalysis.predications[0]?.price | undefined }}
          </div>
          <div>
            Scores Date:
            {{ stockAnalysis.predications[0]?.start | date }}
          </div>
        </div>
      </app-card>
    </div>

    <div class="padding-1rem">
      <app-card>
        <app-links [stock]="stockAnalysis"></app-links>
      </app-card>
    </div>
  </div>
</ng-template>

<!-- <div class="padding-1rem">
    <app-card>
      <h2>Sentiments</h2>
    </app-card>
  </div>

  <div class="padding-1rem">
    <app-card>
      <h2>Technical</h2>
    </app-card>
  </div>

  <div class="padding-1rem">
    <app-card>
      <h2>Macro</h2>
    </app-card>
  </div> -->

<!-- <div class="padding-1rem">
    <div>
      <app-title-menu>
        <div title>News</div>
      </app-title-menu>
    </div>

    <ng-container *ngFor="let item of stockAnalysis.news">
      <app-note [note]="item" class="news-font"></app-note>
    </ng-container>
  </div> -->

<!-- <mat-expansion-panel
  [expanded]="isAllCardOpen"
  (opened)="(true)"
  (closed)="(false)"
>
  <mat-expansion-panel-header>
    <mat-panel-title> 产品 Products </mat-panel-title>
    <mat-panel-description> </mat-panel-description>
  </mat-expansion-panel-header>
  <app-stock-products-list
    [products]="stockAnalysis?.products"
  ></app-stock-products-list>
</mat-expansion-panel> -->

<!-- <div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title> 用户 Customers </mat-panel-title>
    </mat-expansion-panel-header>
    <ul>
      <li *ngFor="let sentence of stockAnalysis?.customers">
        {{ sentence }}
      </li>
    </ul>
  </mat-expansion-panel>
</div> -->

<!-- <div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title> 竞争对手 Competitors </mat-panel-title>
    </mat-expansion-panel-header>
    <ul>
      <li *ngFor="let sentence of stockAnalysis?.competitor">
        {{ sentence }}
      </li>
    </ul>
  </mat-expansion-panel>
</div> -->

<!-- <div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title> 价值,愿景,和解决的痛点 Vision</mat-panel-title>
    </mat-expansion-panel-header>
    <ul>
      <li *ngFor="let sentence of stockAnalysis?.vision">
        {{ sentence }}
      </li>
    </ul>
  </mat-expansion-panel>
</div> -->

<!-- <div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title>商业模式和长期壁垒 Moat </mat-panel-title>
    </mat-expansion-panel-header>
    <ul>
      <li *ngFor="let sentence of stockAnalysis?.businessModel">
        {{ sentence }}
      </li>
    </ul>
  </mat-expansion-panel>
</div> -->

<!-- <div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title>与竞争者的区别和优势 Differeniator </mat-panel-title>
    </mat-expansion-panel-header>
    <ul>
      <li *ngFor="let sentence of stockAnalysis?.advantage">
        {{ sentence }}
      </li>
    </ul>
  </mat-expansion-panel>
</div> -->
<!--
<div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title> 风险 Risks </mat-panel-title>
    </mat-expansion-panel-header>
    <ul>
      <li *ngFor="let risk of stockAnalysis.risks">
        {{ risk.name }}
      </li>
    </ul>
  </mat-expansion-panel>
</div> -->

<!-- <div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title> 市值天花板 Market Cap Potential </mat-panel-title>
    </mat-expansion-panel-header>
    <div>Current: {{ stockAnalysis.predication?.marketCap[0] }}</div>
    <div>Potential: {{ stockAnalysis.predication?.marketCap[1] }}</div>
  </mat-expansion-panel>
</div> -->

<!-- <div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title>趋势（为什么现在是风口）Trend</mat-panel-title>
    </mat-expansion-panel-header>
    <ul>
      <li *ngFor="let sentence of stockAnalysis.trend">
        {{ sentence }}
      </li>
    </ul>
  </mat-expansion-panel>
</div> -->

<!-- <div class="margin-top-20">
  <mat-expansion-panel
    [expanded]="isAllCardOpen"
    (opened)="(true)"
    (closed)="(false)"
  >
    <mat-expansion-panel-header>
      <mat-panel-title> Final Score 我的评分</mat-panel-title>
    </mat-expansion-panel-header>
    <div class="score-line">Score: {{ stockAnalysis.score?.total }} / 100</div>
  </mat-expansion-panel>
</div> -->

<!-- <div *ngIf="stockAnalysis.companyOfficialDocs?.length">
  官方文件链接
  <ul>
    <li *ngFor="let docs of stockAnalysis.companyOfficialDocs">
      <div *ngFor="let link of docs.links">
        <a target="_blank" href="{{ link }}">{{ docs.text }}</a>
      </div>
    </li>
  </ul>
</div>

<div class="margin-top-20" *ngIf="stockAnalysis.usefulVideos?.length">
  有用的参考：（感谢以下材料的作者）
  <ul>
    <li *ngFor="let docs of stockAnalysis.usefulVideos">
      <div *ngFor="let link of docs.links">
        <a target="_blank" href="{{ link }}">{{ docs.text }}</a>
      </div>
    </li>
  </ul>
</div> -->
